<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AI Model Store â€” Local AI</title>
  <link id="hljs-dark" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
  <link id="hljs-light" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css" disabled>
  <link rel="stylesheet" href="css/styles.css">
  <script>
    (function(){
      try {
        var saved = localStorage.getItem('theme');
        var theme = saved || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        document.documentElement.dataset.theme = theme;
        var d = document.getElementById('hljs-dark');
        var l = document.getElementById('hljs-light');
        if (d && l) { d.disabled = (theme === 'light'); l.disabled = (theme !== 'light'); }
      } catch(e) {}
    })();
  </script>
  <style>
    .store { display:flex; flex-direction:column; min-height:100vh; background:var(--bg); color:var(--text); }
    .topbar .nav-actions { display:flex; align-items:center; gap:8px; margin-left:auto }
    .btn-pill { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:12px; border:1px solid var(--soft-border); background:transparent; color:var(--text); cursor:pointer }
    .btn-pill:hover { background:rgba(255,255,255,0.06) }
    .store-controls { display:flex; gap:10px; align-items:center; padding:12px 16px; border-bottom:1px solid var(--border); background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0)); position:sticky; top:56px; z-index:4 }
    .store-search { flex:1; min-width:240px; }
    .store-search input { width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--soft-border); background:#0f1721; color:#e8ecf7 }
    .store-filters { display:flex; gap:8px; flex-wrap:wrap }
    .chip { display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid var(--soft-border); background:#101722; color:#cfd5e2; cursor:pointer; user-select:none }
    .chip[aria-pressed="true"] { background:#16202b; color:#e2e8f0; border-color:#263143 }
    .store-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap:16px; padding:16px }
    .store-card { background:var(--panel-2); border:1px solid var(--soft-border); border-radius:16px; display:flex; flex-direction:column; gap:10px; overflow:hidden }
    .store-card .capsule { height:120px; background:#121a25; display:flex; align-items:flex-end; padding:12px 14px; position:relative }
    .store-card .capsule .glow { position:absolute; inset:0; opacity:.5; pointer-events:none; background:radial-gradient(60% 60% at 80% 20%, rgba(124,58,237,.35), transparent 60%), radial-gradient(50% 50% at 20% 30%, rgba(0,212,255,.2), transparent 60%) }
    .store-card .title { font-weight:700; color:#e9ecf7; display:flex; align-items:center; gap:8px; padding:0 14px }
    .store-card .subtitle { color:var(--muted); font-size:0.9em; padding:0 14px }
    .store-card .badges { display:flex; gap:8px; flex-wrap:wrap }
    .badge { font-size:12px; padding:3px 8px; border-radius:999px; border:1px solid var(--soft-border); background:transparent; color:var(--text) }
    .store-card .metrics { display:flex; gap:10px; flex-wrap:wrap; color:#cfd5e2; font-size:0.92em; padding:0 14px }
    .metrics .kv { background:#0c1219; border:1px solid var(--soft-border); padding:6px 8px; border-radius:8px }
    .install-row { display:flex; align-items:center; gap:10px; padding:0 14px 14px }
    .install-row .spacer { flex:1 }
    .progress { height:8px; background:#0c1219; border:1px solid var(--soft-border); border-radius:999px; overflow:hidden }
    .progress .bar { height:100%; width:0%; background:linear-gradient(90deg,#9c7bff,#7c3aed); transition:width .15s }
    .muted { color:var(--muted) }
    .downloads-dock { position:sticky; bottom:0; left:0; right:0; padding:10px 16px; border-top:1px solid var(--border); background:linear-gradient(180deg, rgba(2,6,12,0.3), rgba(2,6,12,0.8)); backdrop-filter:saturate(1.2) blur(6px); display:none }
    .downloads-dock.visible { display:block }
    .downloads-list { display:flex; gap:10px; overflow:auto }
    .dl-item { min-width:280px; background:var(--panel-2); border:1px solid var(--soft-border); border-radius:12px; padding:10px; color:var(--text) }
    .dl-item .name { font-weight:600 }
    .dl-item .row { display:flex; align-items:center; gap:8px }
    /* Overlay */
    .store-overlay { position:fixed; inset:0; background:rgba(2, 6, 12, 0.8); display:none; align-items:center; justify-content:center; z-index:80 }
    .store-overlay.visible { display:flex }
    .store-modal { width:min(980px, 94vw); max-height:90vh; overflow:auto; border-radius:16px; border:1px solid var(--soft-border); background:#0f161f; box-shadow:var(--shadow-1) }
    .store-hero { position:relative; height:200px; background:#121a25; display:flex; align-items:flex-end; padding:16px }
    .store-hero .glow { position:absolute; inset:0; pointer-events:none }
    .store-hero .meta { position:relative; z-index:1 }
    .store-hero h2 { margin:0 0 4px; font-size:22px; color:#e9ecf7 }
    .store-hero .muted { color:#b0bbcd }
    .store-body { padding:14px 16px 18px }
    .variants { border:1px solid var(--soft-border); border-radius:12px; overflow:hidden }
    .variants .row { display:grid; grid-template-columns: 1.2fr .7fr .7fr 1.2fr auto; gap:8px; align-items:center; padding:10px 12px; border-bottom:1px solid rgba(255,255,255,0.05) }
    .variants .row.header { background:#101722; font-weight:600; color:#cfd5e2 }
    .variants .row:last-child { border-bottom:0 }
    .variants .row:hover { background:#0c1219 }
    /* Light theme overrides specific to store page */
    [data-theme="light"] .store-card { background:#ffffff; border-color:#e5e7eb }
    [data-theme="light"] .store-card .capsule { background:#f3f4f6 }
    [data-theme="light"] .badge { background:#f3f4f6; border-color:#e5e7eb; color:#374151 }
    [data-theme="light"] .store-card .title { color:#111827 }
    [data-theme="light"] .store-card .capsule .muted { color:#374151 }
    [data-theme="light"] .store-card .metrics .kv { background:#f9fafb; border-color:#e5e7eb; color:#374151 }
    [data-theme="light"] .btn-pill { background:#ffffff; border-color:#e5e7eb; color:#111827 }
    [data-theme="light"] .btn-pill:hover { background:#eef2ff; border-color:#c7d2fe; color:#1e3a8a }
    [data-theme="light"] .progress { background:#f3f4f6; border-color:#e5e7eb }
    [data-theme="light"] .downloads-dock { background:linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.95)); border-top:1px solid #e5e7eb }
    [data-theme="light"] .dl-item { background:#ffffff; border-color:#e5e7eb; color:#374151 }
    /* --- Model Packs: improved bullet list --- */
    .pack-list { list-style:none; margin:6px 0 10px; padding:6px 14px 0; display:flex; flex-direction:column; gap:6px }
    .pack-list li { display:flex; align-items:flex-start; gap:10px; padding:8px 10px; border:1px solid var(--soft-border); background:rgba(255,255,255,0.03); border-radius:10px; color:var(--text) }
    .pack-list li::before { content:""; width:8px; height:8px; border-radius:50%; flex:0 0 8px; margin-top:6px; background:radial-gradient(circle at 30% 30%, #9c7bff, #7c3aed); box-shadow:0 0 0 2px rgba(124,58,237,0.28) }
    .pack-list code { background:#0c1219; border:1px solid var(--soft-border); padding:2px 6px; border-radius:6px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size:12px; color:var(--text) }
    .pack-list li:hover { background:rgba(124,58,237,0.08); border-color:#9c7bff66 }
    /* Apply improved styling to existing lists without changing markup */
    #starterPacks .store-card ul, #modelPacks .store-card ul { list-style:none; margin:6px 0 10px; padding:6px 14px 0; display:flex; flex-direction:column; gap:6px }
    #starterPacks .store-card ul li, #modelPacks .store-card ul li { display:flex; align-items:flex-start; gap:10px; padding:8px 10px; border:1px solid var(--soft-border); background:rgba(255,255,255,0.03); border-radius:10px; color:var(--text) }
    #starterPacks .store-card ul li::before, #modelPacks .store-card ul li::before { content:""; width:8px; height:8px; border-radius:50%; flex:0 0 8px; margin-top:6px; background:radial-gradient(circle at 30% 30%, #9c7bff, #7c3aed); box-shadow:0 0 0 2px rgba(124,58,237,0.28) }
    #starterPacks .store-card ul code, #modelPacks .store-card ul code { background:#0c1219; border:1px solid var(--soft-border); padding:2px 6px; border-radius:6px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size:12px; color:var(--text) }
    #starterPacks .store-card ul li:hover, #modelPacks .store-card ul li:hover { background:rgba(124,58,237,0.08); border-color:#9c7bff66 }
    /* Light theme tweaks */
    [data-theme="light"] .pack-list li { background:#f9fafb; border-color:#e5e7eb; color:#111827 }
    [data-theme="light"] .pack-list code { background:#ffffff; border-color:#e5e7eb; color:#1f2937 }
    [data-theme="light"] .pack-list li:hover { background:#eef2ff; border-color:#c7d2fe }
    /* Light theme for existing lists */
    [data-theme="light"] #starterPacks .store-card ul li,
    [data-theme="light"] #modelPacks .store-card ul li { background:#f9fafb; border-color:#e5e7eb; color:#111827 }
    [data-theme="light"] #starterPacks .store-card ul code,
    [data-theme="light"] #modelPacks .store-card ul code { background:#ffffff; border-color:#e5e7eb; color:#1f2937 }
    [data-theme="light"] #starterPacks .store-card ul li:hover,
    [data-theme="light"] #modelPacks .store-card ul li:hover { background:#eef2ff; border-color:#c7d2fe }
    [data-theme="light"] .store-overlay { background:rgba(17,24,39,0.25) }
    [data-theme="light"] .store-modal { background:#ffffff; border-color:#e5e7eb }
    [data-theme="light"] .store-hero { background:#f3f4f6 }
    [data-theme="light"] .store-hero .muted { color:#4b5563 }
    [data-theme="light"] .store-card .metrics { color:#374151 }
    [data-theme="light"] .variants { border-color:#e5e7eb }
    [data-theme="light"] .variants .row { border-bottom:1px solid rgba(0,0,0,0.06) }
    [data-theme="light"] .variants .row.header { background:#f9fafb; color:#374151 }
    [data-theme="light"] .variants .row:hover { background:#f3f4f6 }
    [data-theme="light"] .store-search input { background:#ffffff; border:1px solid #e5e7eb; color:#111827 }
    [data-theme="light"] .chip { background:#ffffff; border-color:#e5e7eb; color:#374151 }
    [data-theme="light"] .chip[aria-pressed="true"] { background:#eef2ff; border-color:#c7d2fe; color:#1e3a8a }
    /* Recommended section */
    .highlighted-recommendations { margin: 12px 16px 0; padding: 16px 16px 8px; border:1px solid var(--soft-border); border-radius:16px; background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0)); }
    .highlighted-recommendations .rec-heading { font-weight:800; font-size:22px; line-height:1.25; margin:2px 2px 6px; color:#eef2ff; letter-spacing:0.2px }
    .highlighted-recommendations .cap-text { position:relative; z-index:1 }
    .highlighted-recommendations .cap-title { font-size:20px; line-height:1.25; font-weight:800; color:#edf2ff }
    .highlighted-recommendations .cap-subtitle { font-size:14.5px; line-height:1.35; color:#d9e2f1 }
    .highlighted-recommendations .install-row .btn-pill { font-size:14px; font-weight:600; padding:10px 14px }
    [data-theme="light"] .highlighted-recommendations { background:linear-gradient(180deg, rgba(0,0,0,0.03), rgba(0,0,0,0)); border-color:#e5e7eb }
    [data-theme="light"] .highlighted-recommendations .rec-heading { color:#111827 }
    [data-theme="light"] .highlighted-recommendations .cap-title { color:#0f172a }
    [data-theme="light"] .highlighted-recommendations .cap-subtitle { color:#334155 }
  </style>
</head>
<body class="store">
  <div class="topbar">
    <div class="brand">
      <span class="models" style="cursor:default"><span class="icon"><svg viewBox="0 0 24 24" fill="currentColor"><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/></svg></span><span class="title">Model Store</span></span>
    </div>
    <div class="nav-actions">
      <button class="btn-pill" onclick="location.href='index.html'" type="button"><span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M15 18l-6-6 6-6"/></svg></span> Back to Chat</button>
    </div>
  </div>
  <div class="store-controls">
    <div class="store-search"><input id="searchInput" type="search" placeholder="Search models, companies, families" /></div>
    <div class="store-filters" role="group" aria-label="Filters">
      <div class="chip" data-filter="all" aria-pressed="true">All</div>
      <div class="chip" data-filter="multimodal">Multimodal</div>
      <div class="chip" data-filter="reasoning">Reasoning</div>
      <div class="chip" data-filter="embeddings">Embeddings</div>
      <div class="chip" data-filter="assistant">Assistant</div>
      <div class="chip" data-filter="installed">Installed</div>
    </div>
    <div style="margin-left:auto;display:flex;gap:8px">
      <button id="installOllamaStarterMS" class="btn-pill" type="button">Install Ollama Starter Pack</button>
    </div>
  </div>
  <section id="highlightedGrid" class="highlighted-recommendations" aria-label="Recommended open alternatives" style="display:none">
    <div class="rec-heading">ðŸ”¥ Run These Powerful Alternatives â€” Locally</div>
    <div class="store-grid"></div>
  </section>
    <section id="starterPacks" style="margin:16px 16px 0">
      <div style="display:flex;gap:16px;flex-wrap:wrap">
        <div class="store-card" style="flex:1;min-width:320px">
          <div class="capsule">
            <div class="glow" style="background:radial-gradient(60% 60% at 80% 20%, rgba(34,197,94,.28), transparent 60%), radial-gradient(50% 50% at 20% 30%, rgba(59,130,246,.24), transparent 60%)"></div>
            <div class="cap-text">
              <div class="cap-title">Ollama Starter Pack</div>
              <div class="cap-subtitle">Perfect first-time local setup</div>
            </div>
          </div>
          <div style="padding:10px 14px 0;color:var(--muted)">Installs three curated assistants optimized for local use.</div>
          <ul style="padding:6px 22px 0;margin:0 0 8px 0;color:var(--text)">
            <li><b>Gemma3 Mini</b> â€” standard use (<code>gemma3:4b</code>)</li>
            <li><b>Qwen3 Mini</b> â€” 4o-style chatting (<code>qwen3:4b</code>)</li>
            <li><b>Phi4 Reasoning Mini</b> â€” o4-mini alternative (<code>phi4-mini-reasoning:3.8b</code>)</li>
          </ul>
          <div class="install-row"><div class="spacer"></div><button id="starterInstallBtn" class="btn-pill" type="button">Install Pack</button></div>
        </div>

        <div class="store-card" style="flex:1;min-width:320px">
          <div class="capsule">
            <div class="glow" style="background:radial-gradient(60% 60% at 80% 20%, rgba(124,58,237,.30), transparent 60%), radial-gradient(50% 50% at 20% 30%, rgba(0,212,255,.18), transparent 60%)"></div>
            <div class="cap-text">
              <div class="cap-title">Install Llama.cpp Model</div>
              <div class="cap-subtitle">Install a GGUF model from Hugging Face</div>
            </div>
          </div>
          <div style="padding:10px 14px 0;color:var(--muted)">Select a model from the dropdown and click install. The model will be downloaded and the llama.cpp server will be started.</div>
          <div style="padding:10px 14px 0;">
            <select id="llamacppModelSelect" class="store-search" style="width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--soft-border); background: #0f1721; color: #e8ecf7;"></select>
          </div>
          <div class="install-row"><div class="spacer"></div><button id="installLlamaCppModel" class="btn-pill" type="button">Install for llama.cpp</button></div>
        </div>
      </div>
    </section>
  <section id="modelPacks" style="margin:20px 16px 0">
    <h2 style="margin:0 0 8px 0; font-size:18px">Model Packs</h2>
    <div id="packsGrid" class="store-grid"></div>
  </section>
  <div id="storeGrid" class="store-grid" aria-live="polite"></div>
  <div id="downloadsDock" class="downloads-dock">
    <div class="downloads-list" id="downloadsList"></div>
  </div>
  <div id="storeOverlay" class="store-overlay" role="dialog" aria-modal="true" aria-label="Model details">
    <div class="store-modal">
      <div class="store-hero">
        <div class="glow" id="ovGlow"></div>
        <div class="meta">
          <h2 id="ovTitle">Model Family</h2>
          <div class="muted" id="ovSubtitle">Company Â· Tags</div>
        </div>
        <div style="margin-left:auto; z-index:1"><button class="btn-pill" id="ovClose" type="button">Close</button></div>
      </div>
      <div class="store-body">
        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px" id="ovBadges"></div>
        <div class="variants" id="ovVariants"></div>
      </div>
    </div>
  </div>
  <script src="js/model-store.js"></script>
  <script>
  // Lightweight Model Packs rendering and installer
  (function(){
    const packs = [
      { id:'general-starter', title:'General Starter', desc:'Balanced small assistants for common tasks', items:['qwen2.5:3b','gemma2:2b','llama3.2:3b'] },
      { id:'coding-starter', title:'Coding Starter', desc:'Local code helpers and explainers', items:['codellama:7b','qwen2.5-coder:3b','starcoder2:3b'] },
      { id:'reasoning-mini', title:'Reasoning Mini', desc:'Small reasoning-first choices', items:['phi4-mini-reasoning:3.8b','llama3.1:8b'] }
    ];
    const grid = document.getElementById('packsGrid'); if(!grid) return;
    function card(p){
      const el = document.createElement('div'); el.className = 'store-card';
      el.innerHTML = `
        <div class="capsule"><div class="glow"></div><div class="cap-text"><div class="cap-title">${p.title}</div><div class="cap-subtitle">${p.desc}</div></div></div>
        <div style="padding:10px 14px 0;color:var(--muted)">Installs:</div>
        <ul style="padding:6px 22px 0;margin:0 0 8px 0;color:var(--text)">${p.items.map(id=>`<li><code>${id}</code></li>`).join('')}</ul>
        <div class="install-row"><div class="spacer"></div><button class="btn-pill" type="button" data-pack="${p.id}">Install Pack</button></div>
      `;
      return el;
    }
    packs.forEach(p=> grid.appendChild(card(p)));
    grid.addEventListener('click', async (e)=>{
      const b = e.target.closest('button[data-pack]'); if(!b) return;
      const id = b.getAttribute('data-pack'); const pack = packs.find(x=>x.id===id); if(!pack) return;
      b.disabled = true; const prev = b.textContent; b.textContent = 'Installingâ€¦';
      try{
        for(const name of pack.items){ await fetch('/api/store/pull', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ name }) }); }
        alert('Pack installed (queued).');
      }catch{ alert('Failed to install pack.'); }
      b.disabled = false; b.textContent = prev;
    });
  })();

  document.getElementById('starterInstallBtn')?.addEventListener('click', async ()=>{
    try{
      const r = await fetch('/api/install/starter-pack', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ pack: 'ollama-starter' }) });
      const j = await r.json();
      if(!r.ok || !j.ok){ alert('Failed to start installs'); return; }
      // If server returned jobs, attach them to the dock to show progress
      if(Array.isArray(j.jobs)){
        for(const job of j.jobs){ try{ window.attachStoreJob && window.attachStoreJob(job); }catch{} }
      }
      alert('Installing Ollama Starter Packâ€¦');
    }catch(e){ alert('Install failed'); }
  });

  // Llama.cpp Model installer with progress (downloads to /models)
  async function populateLlamaCppModels() {
    const select = document.getElementById('llamacppModelSelect');
    if (!select) return;
    try {
      const response = await fetch('/api/store/models');
      const data = await response.json();
      const llamacppModels = data.items.filter(m => m.id.includes('gguf'));
      llamacppModels.forEach(model => {
        const option = document.createElement('option');
        option.value = model.id;
        option.textContent = model.name;
        select.appendChild(option);
      });
    } catch (error) {
      console.error('Failed to populate llama.cpp models:', error);
    }
  }

  document.getElementById('installLlamaCppModel')?.addEventListener('click', async ()=>{
    const b = document.getElementById('installLlamaCppModel'); if(!b) return;
    const select = document.getElementById('llamacppModelSelect');
    const model_id = select.value;
    if (!model_id) {
      alert('Please select a model to install.');
      return;
    }

    b.disabled = true; const prev = b.textContent; b.textContent = 'Preparingâ€¦';
    try{
      // Ensure llama.cpp binary is present or try install (Windows uses winget)
      const a = await fetch('/api/install/llamacpp', { method:'POST' });
      const aj = await a.json();
      if(!aj.ok){ alert(aj.error || 'Failed to prepare llama.cpp'); b.disabled=false; b.textContent=prev; return; }
      // Enqueue HF download job for llama.cpp
      const r = await fetch('/api/store/llamacpp/pull', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ model_id }) });
      const j = await r.json();
      if(r.ok && j && j.id){
        try{ window.attachStoreJob && window.attachStoreJob(j); }catch{}
      } else {
        alert('Failed to start llama.cpp download');
      }
    }catch(e){ alert('Install failed'); }
    b.disabled = false; b.textContent = prev;
  });

  populateLlamaCppModels();
  // Minimal enqueue helper for the recommended section
  function enqueueModel(name) {
    fetch('/api/store/pull', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name })
    }).then(resp => {
      if (!resp.ok) {
        alert('Failed to install model.');
      }
    }).catch(() => {
      alert('Failed to install model.');
    });
  }
  </script>
</body>
</html>
